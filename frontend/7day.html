<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DietGenie | 7-Day Personalized Meal Plan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.8s ease-out forwards;
    }
    .animate-slideUp {
      animation: slideUp 0.6s ease-out forwards;
    }
    .animate-pulse-soft {
      animation: pulse 2s ease-in-out infinite;
    }
    .animate-spin-slow {
      animation: spin 3s linear infinite;
    }
    .stagger-1 { animation-delay: 0.1s; }
    .stagger-2 { animation-delay: 0.2s; }
    .stagger-3 { animation-delay: 0.3s; }
    .stagger-4 { animation-delay: 0.4s; }
    .tab-active {
      background: linear-gradient(135deg, #4CAF50 0%, #26A69A 100%);
      color: white;
      transform: scale(1.05);
    }
  </style>
</head>
<body class="bg-[#F9F9F9] text-[#333333] min-h-screen">

  <!-- Include navbar -->
  {% include 'navbar.html' %}

  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-[#4CAF50] to-[#26A69A] text-white py-20 px-4 overflow-hidden">
    <div class="absolute inset-0 opacity-10">
      <div class="absolute top-10 left-10 w-64 h-64 bg-white rounded-full blur-3xl"></div>
      <div class="absolute bottom-10 right-10 w-96 h-96 bg-white rounded-full blur-3xl"></div>
    </div>
    <div class="max-w-4xl mx-auto text-center relative z-10">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 animate-fadeIn">Your 7-Day Personalized Meal Plan ü•ó</h1>
      <p class="text-lg md:text-xl opacity-90 animate-fadeIn stagger-1">Get a full week of healthy, balanced Indian meals curated by AI for your health goals.</p>
    </div>
  </section>

  <!-- Main Content -->
  <main class="max-w-6xl mx-auto px-4 py-12">
    
    <!-- User Input Form -->
    <section id="formSection" class="mb-12 animate-slideUp">
      <div class="bg-white rounded-2xl shadow-lg p-8 md:p-10">
        <h2 class="text-3xl font-bold text-[#26A69A] mb-6 text-center">Tell Us About Yourself</h2>
        
        <form id="form7day" class="space-y-6">
          <div class="grid md:grid-cols-2 gap-6">
            
            <!-- Age -->
            <div class="relative">
              <label class="block text-sm font-semibold mb-2 text-[#333]">
                <i class="fas fa-birthday-cake text-[#FFA726] mr-2"></i>Age
              </label>
              <input 
                type="number" 
                name="age" 
                placeholder="Enter your age" 
                required 
                min="5"
                max="120"
                class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-[#26A69A] focus:outline-none transition"
              >
            </div>

            <!-- Gender -->
            <div class="relative">
              <label class="block text-sm font-semibold mb-2 text-[#333]">
                <i class="fas fa-venus-mars text-[#FFA726] mr-2"></i>Gender
              </label>
              <select 
                name="gender" 
                required 
                class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-[#26A69A] focus:outline-none transition"
              >
                <option value="">Select Gender</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- Health Goal -->
            <!-- <div class="relative">
              <label class="block text-sm font-semibold mb-2 text-[#333]">
                <i class="fas fa-bullseye text-[#FFA726] mr-2"></i>Health Goal
              </label>
              <select 
                name="health_goal" 
                required 
                class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-[#26A69A] focus:outline-none transition"
              >
                <option value="">Select Your Goal</option>
                <option value="Weight Loss">Weight Loss</option>
                <option value="Diabetes Management">Diabetes Management</option>
                <option value="Balanced Diet">Balanced Diet</option>
                <option value="PCOD">PCOD Management</option>
                <option value="Heart Health">Heart Health</option>
                <option value="Muscle Gain">Muscle Gain</option>
              </select>
            </div> -->

            <!-- Dietary Preference -->
            <!-- <div class="relative">
              <label class="block text-sm font-semibold mb-2 text-[#333]">
                <i class="fas fa-leaf text-[#FFA726] mr-2"></i>Dietary Preference
              </label>
              <select 
                name="dietary_preference" 
                required 
                class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-[#26A69A] focus:outline-none transition"
              >
                <option value="">Select Preference</option>
                <option value="Vegetarian">Vegetarian</option>
                <option value="Non-Vegetarian">Non-Vegetarian</option>
                <option value="Vegan">Vegan</option>
                <option value="Eggetarian">Eggetarian</option>
              </select>
            </div> -->

          </div>

          <!-- Health Conditions / Allergies -->
          <div class="relative">
            <label class="block text-sm font-semibold mb-2 text-[#333]">
              <i class="fas fa-allergies text-[#FFA726] mr-2"></i>Health Conditions
            </label>
            <input 
              type="text" 
              name="health_conditions" 
              placeholder="e.g., BP, Diabetes, Obesity" 
              class="w-full p-3 border-2 border-gray-200 rounded-lg focus:border-[#26A69A] focus:outline-none transition"
            >
            <p class="text-xs text-gray-500 mt-1">Separate multiple conditions with commas</p>
          </div>

          <!-- Submit Button -->
          <button 
            id="generateBtn" 
            type="submit" 
            class="w-full bg-[#FFA726] hover:bg-[#fb8c00] text-white font-bold py-4 rounded-lg transition transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-2"
          >
            <i class="fas fa-magic"></i>
            <span>Generate My 7-Day Plan</span>
          </button>
        </form>
      </div>
    </section>

    <!-- Loading Animation -->
    <section id="loadingSection" class="hidden mb-12">
      <div class="bg-white rounded-2xl shadow-lg p-12 text-center">
        <div class="animate-spin-slow inline-block text-8xl mb-6">üçΩÔ∏è</div>
        <h3 class="text-2xl font-bold text-[#26A69A] mb-2">Preparing your 7-day meal journey...</h3>
        <p class="text-gray-600">Our AI nutritionist is crafting the perfect plan for you!</p>
        <div class="mt-6 flex justify-center gap-2">
          <div class="w-3 h-3 bg-[#4CAF50] rounded-full animate-pulse"></div>
          <div class="w-3 h-3 bg-[#26A69A] rounded-full animate-pulse stagger-1"></div>
          <div class="w-3 h-3 bg-[#FFA726] rounded-full animate-pulse stagger-2"></div>
        </div>
      </div>
    </section>

    <!-- Results Section -->
    <section id="resultsSection" class="hidden">
      
      <!-- Day Tabs -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h2 class="text-3xl font-bold text-[#4CAF50] mb-6 text-center">Your Weekly Meal Plan</h2>
        
        <!-- Tab Navigation -->
        <div class="flex flex-wrap gap-2 mb-6 justify-center">
          <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition transform hover:scale-105" data-day="0">Day 1</button>
          <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition transform hover:scale-105" data-day="1">Day 2</button>
          <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition transform hover:scale-105" data-day="2">Day 3</button>
          <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition transform hover:scale-105" data-day="3">Day 4</button>
          <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition transform hover:scale-105" data-day="4">Day 5</button>
          <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition transform hover:scale-105" data-day="5">Day 6</button>
          <button class="tab-btn px-6 py-3 rounded-lg font-semibold transition transform hover:scale-105" data-day="6">Day 7</button>
        </div>

        <!-- Tab Content -->
        <div id="tabContent"></div>
      </div>

      <!-- Nutrition Chart -->
      <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
        <h3 class="text-2xl font-bold text-[#26A69A] mb-6 text-center">Weekly Nutrition Overview</h3>
        <canvas id="nutritionChart" class="max-h-96"></canvas>
      </div>

      <!-- Disclaimer -->
      <!-- <div class="bg-[#FFEB3B] bg-opacity-20 border-l-4 border-[#FFEB3B] rounded-lg p-6 mb-8">
        <div class="flex items-start gap-3">
          <i class="fas fa-info-circle text-[#FFA726] text-2xl mt-1"></i>
          <div>
            <h4 class="font-bold text-lg mb-2">Important Disclaimer</h4>
            <p class="text-sm">This meal plan is generated by AI for general guidance and educational purposes. Please consult your healthcare professional or registered dietitian for personalized nutritional advice tailored to your specific medical conditions.</p>
          </div>
        </div>
      </div> -->

      <!-- CTA Section -->
      <div class="grid md:grid-cols-2 gap-4">
        <button class="bg-[#2E7D32] hover:bg-[#1B5E20] text-white font-bold py-4 rounded-lg transition transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-2">
          <i class="fas fa-download"></i>
          <span>Download as PDF</span>
        </button>
        <button class="bg-[#FFA726] hover:bg-[#fb8c00] text-white font-bold py-4 rounded-lg transition transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-2">
          <i class="fas fa-share-alt"></i>
          <span>Share My Plan</span>
        </button>
      </div>

    </section>

  </main>

  <!-- Include footer -->
  {% include 'footer.html' %}

  <script>
    let weeklyData = [];
    let nutritionChart = null;

    // Form submission
    document.getElementById("form7day").addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const generateBtn = document.getElementById("generateBtn");
      const formSection = document.getElementById("formSection");
      const loadingSection = document.getElementById("loadingSection");
      const resultsSection = document.getElementById("resultsSection");

      generateBtn.disabled = true;
      formSection.classList.add("opacity-50");
      loadingSection.classList.remove("hidden");
      resultsSection.classList.add("hidden");

      const formData = new FormData(e.target);

      try {
        const response = await fetch("/plan/7day", { method: "POST", body: formData });
        if (!response.ok) {
          const txt = await response.text();
          throw new Error(txt);
        }
        weeklyData = await response.json();

        // Hide loading, show results
        loadingSection.classList.add("hidden");
        resultsSection.classList.remove("hidden");
        formSection.classList.add("hidden");

        // Render first day by default
        renderDay(0);
        renderNutritionChart();

        // Scroll to results
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

      } catch (err) {
        alert("Error: " + err.message);
        loadingSection.classList.add("hidden");
      } finally {
        generateBtn.disabled = false;
        formSection.classList.remove("opacity-50");
      }
    });

    // Tab functionality
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('tab-btn')) {
        const dayIndex = parseInt(e.target.dataset.day);
        renderDay(dayIndex);
        
        // Update active tab
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('tab-active');
          btn.classList.add('bg-gray-200', 'text-gray-700');
        });
        e.target.classList.add('tab-active');
        e.target.classList.remove('bg-gray-200', 'text-gray-700');
      }
    });

    // Render specific day
    function renderDay(dayIndex) {
      const dayPlan = weeklyData[dayIndex];
      const tabContent = document.getElementById('tabContent');
      
      let html = `<div class="space-y-4">`;
      
      const mealIcons = {
        'Breakfast': 'üåÖ',
        'Lunch': '‚òÄÔ∏è',
        'Dinner': 'üåô',
        'Snacks': 'üçé'
      };

      Object.entries(dayPlan.Meals).forEach(([meal, details], idx) => {
        const exp = dayPlan.Explanations[idx];
        const icon = mealIcons[meal] || 'üçΩÔ∏è';
        
        html += `
          <div class="bg-gradient-to-r from-[#26A69A] to-[#4CAF50] bg-opacity-10 border-l-4 border-[#FFA726] p-5 rounded-lg shadow-md hover:shadow-xl transition animate-slideUp stagger-${idx + 1}">
            <h4 class="text-xl font-bold text-[#333] mb-2 flex items-center gap-2">
              <span class="text-2xl">${icon}</span>
              ${meal}
            </h4>
            <p class="text-gray-800 mb-3 font-medium">${details}</p>
            <p class="text-sm text-gray-600 italic border-t border-gray-300 pt-2">üí° ${exp}</p>
          </div>
        `;
      });

      html += `
        <div class="bg-[#4CAF50] bg-opacity-10 p-5 rounded-lg text-center border-2 border-[#4CAF50]">
          <p class="text-xl font-bold text-[#2E7D32]">üî• Total Daily Calories: ${dayPlan['Total Calories'].toFixed(0)} kcal</p>
        </div>
      </div>`;

      tabContent.innerHTML = html;

      // Set first tab as active on initial render
      if (dayIndex === 0) {
        const firstTab = document.querySelector('.tab-btn');
        firstTab.classList.add('tab-active');
        firstTab.classList.remove('bg-gray-200', 'text-gray-700');
      }
    }

    // Render nutrition chart
    function renderNutritionChart() {
      const ctx = document.getElementById('nutritionChart');
      
      if (nutritionChart) {
        nutritionChart.destroy();
      }

      const days = weeklyData.map((_, i) => `Day ${i + 1}`);
      const calories = weeklyData.map(d => d['Total Calories']);

      nutritionChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: days,
          datasets: [{
            label: 'Daily Calories',
            data: calories,
            backgroundColor: 'rgba(255, 167, 38, 0.6)',
            borderColor: '#FFA726',
            borderWidth: 2,
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: { font: { size: 14, weight: 'bold' } }
            },
            tooltip: {
              backgroundColor: 'rgba(0,0,0,0.8)',
              padding: 12,
              titleFont: { size: 14 },
              bodyFont: { size: 13 }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(0,0,0,0.05)' },
              ticks: { font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { font: { size: 12, weight: 'bold' } }
            }
          }
        }
      });
    }

    // Initialize tabs with proper styling
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.classList.add('bg-gray-200', 'text-gray-700');
    });
  </script>

</body>
</html>